<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COAA | Cadastro</title>
    <link rel="stylesheet" href="../css/style_cadastro.css">
</head>

<body>
    <div id="tela1" style="display: block;">
        <!--Começo página-->
        <div class="header">
            <div class="titulosAdm">
                <h1>Cadastro Administrador</h1>
            </div>


            <img src="../img/logotipo.png">
        </div>
        <!--Fim começo página-->

        <!--Formulário-->
        <div class="form">

            <div class="formBlock">
                <h1>Informações do usuário</h1>
                <div class="inputContainer">

                    <div>
                        <label class="label">Nome Completo:</label>
                        <input type="text" id="ipt_nomeAdm" placeholder="Insira seu nome"></label>
                    </div>


                    <div>
                        <label class="label">Senha:</label>
                        <input type="password" id="ipt_senhaAdm" placeholder="*******">
                    </div>


                    <div>
                        <label class="label">E-mail:</label>
                        <input type="text" id="ipt_emailAdm" placeholder="Seu e-mail">
                    </div>

                    <div>
                        <label class="label">Confirmação de senha:</label>
                        <input type="password" id="ipt_checkSenhaAdm" placeholder="*******">
                    </div>

                    <div>
                        <label class="label">CPF:</label>
                        <input type="text" id="ipt_cpfAdm" placeholder="Insira seu CPF">
                    </div>

                </div>

                <div class="linha">
                    <div class="btnVoltar">
                        <button><a href="../index.html">Voltar</a></button>
                    </div>

                    <div class="btn">
                        <button onclick="cadastraUser()">Avançar</button>
                    </div>
                </div>
                    
            </div>

        </div>

        <!--Fim Formulário-->
    </div>

    <div id="tela2" style="display: none;">
        <!--Começo página-->
        <div class="header">
            <h1>Cadastro Empresa</h1>

            <img src="../img/logotipo.png">
        </div>
        <!--Fim começo página-->

        <!--Formulário-->
        <div class="form">
            <div class="linha segunda">
                <div class="formBlock">
                    <div class="tituloEmpresa">
                        <h1>Informações</h1>
                    </div>
                    
                    <div class="inputContainer">

                        <div>
                            <label class="label">Nome:</label>
                            <input type="text" id="ipt_nomeEmpresa" placeholder="Insira o nome da empresa"></label>
                        </div>
                        
                        
                        <div>
                        <label class="label">Descrição:</label>
                        <input type="text" id="ipt_descricaoEmpresa" placeholder="Descrição da empresa">
                    </div>
                    
                    
                    <div>
                        <label class="label">CNPJ:</label>
                        <input type="text" id="ipt_cnpj" placeholder="Insira o CNPJ da empresa">
                    </div>
                    
                </div>
            </div>
            
            <div class="formBlock">
                <div class="formContatoEmpresa">
                    <h1>Contato</h1>
                <div class="inputContainer">
                    
                    <div>
                        <label class="label">Telefone:</label>
                        <input type="text" id="ipt_telefone" placeholder="Insira o telefone">
                    </div>
                    
                    <div>
                        <label class="label">Email:</label>
                        <input type="email" id="ipt_email" placeholder="E-mail da empresa">
                    </div>
                    
                    <div>
                        <label class="label">Confirmar email:</label>
                        <input type="email" id="ipt_emailConfirm" placeholder="Confirme o e-mail">
                    </div>
                    
                </div>
                </div>
                
            </div>
        </div>

            <div class="formBlock">
                <h1>Endereço</h1>
                <div class="inputContainer">
                    <div>
                        <label class="label">Rua:</label>
                        <input type="text" id="ipt_rua" placeholder="Rua">
                    </div>
                    
                    <div>
                        <label class="label">Número:</label>
                        <input type="number" id="ipt_numero" placeholder="Número">
                    </div>
                    
                    <div>
                        <label class="label">Complemento:</label>
                        <input type="text" id="ipt_complemento" placeholder="Complemento">
                    </div>

                    <div>
                        <label class="label">CEP:</label>
                        <input type="text" id="ipt_cep" placeholder="CEP">
                    </div>
                    
                    <div>
                        <label class="label">Bairro:</label>
                        <input type="text" id="ipt_bairro" placeholder="Bairro">
                    </div>

                    <div>
                        <label class="label">Cidade:</label>
                        <input type="text" id="ipt_cidade" placeholder="Cidade">
                    </div>
                    
                    <div>
                        <label class="label">Estado:</label>
                        <input type="text" id="ipt_estado" placeholder="Estado">
                    </div>
                </div>
                <!--Fim Formulário-->
            </div>

            <div class="linhaTerceira ">
                <div class="btnVoltar">
                    <button><a href="#tela1">Voltar</a></button>
                </div>

                <div class="btn">
                    <button onclick="cadastraEmpresa()">Avançar</button>
                </div>
            </div>
            </div>

    </div>

    <div id="tela3" style="display: none;">
        <!--Começo página-->
        <div class="header">
            <h1>Cadastro Fábrica</h1>

            <img src="../img/logotipo.png">
        </div>
        <!--Fim começo página-->

        <!--Formulário-->
        <div class="form">
            <div class="margemCadastro">
                <div class="formBlock">
                    <h1>Informações</h1>
                    <div class="inputContainer">
                        <div>
                            <label class="label">Nome:</label>
                            <input type="text" id="ipt_nomefabrica" placeholder="Insira o nome da fábrica"></label>
                        </div>
                        <div>
                            <label class="label">Telefone:</label>
                            <input type="text" id="ipt_telefoneFabrica" placeholder="Telefone">
                        </div>
                    </div>
            </div>
            
            <div class="formBlock">
                <div class="formSetor">
                      <h1>Setores</h1>
                <div class="inputContainer">
                    <div>
                        <label class="label">Número de setores:</label>
                        <input type="text" id="ipt_numSetores" placeholder="2">
                    </div>
                </div>
                </div>
                <br><br>

            </div>
        </div>
            
            <div class="formBlock">
                <h1>Endereço</h1>
                <div class="inputContainer">
                    <div>
                        <label class="label">Rua:</label>
                        <input type="text" id="ipt_ruaFabrica" placeholder="Logradouro">
                    </div>
                    <div>
                        <label class="label">Número:</label>
                        <input type="number" id="ipt_numeroFabrica" placeholder="Número">
                    </div>
                    <div>
                        <label class="label">Complemento:</label>
                        <input type="text" id="ipt_complementoFabrica" placeholder="Complemento">
                    </div>
                    <div>
                        <label class="label">CEP:</label>
                        <input type="text" id="ipt_cepFabrica" placeholder="CEP">
                    </div>
                    <div>
                        <label class="label">Bairro:</label>
                        <input type="text" id="ipt_bairroFabrica" placeholder="Bairro">
                    </div>
                    <div>
                        <label class="label">Cidade:</label>
                        <input type="text" id="ipt_cidadeFabrica" placeholder="Cidade">
                    </div>
                    <div>
                        <label class="label">Estado:</label>
                        <input type="text" id="ipt_EstadoFabrica" placeholder="Estado">
                    </div>
                </div>
                <!--Fim Formulário-->
                <div class="linha">
                    <div class="btnVoltar">
                        <button><a href="#tela2">Voltar</a></button>
                    </div>

                    <div class="btn">
                        <button onclick="cadastraFabrica()">Avançar</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

</body>

<script src="../js/script.js"></script>
<script src="../js/funcoes.js"></script>

</html>
<script>

    function cadastraUser() {
        
        var nomeVar = ipt_nomeAdm.value;//Obrigatório
        var senhaVar = ipt_senhaAdm.value;//Obrigatório
        var emailVar = ipt_emailAdm.value;//Obrigatório
        var cpfVar = ipt_cpfAdm.value;//Obrigatório
        var chkSenhaVar = ipt_checkSenhaAdm.value;//Obrigatório

        //Verificação de campos vazios
        var valida_vazio = nomeVar == "" && senhaVar == "" && emailVar == "" && cpfVar == "" && chkSenhaVar == ""; //Todos os campos  estão vazios
        var nome_vazio = nomeVar == ""; //Nome está vazio

        // Validações (Se verdadeiras, os campos estão incorretos)
        var verif_chkSenha = senhaVar != chkSenhaVar || chkSenhaVar == ""; //Senha diferente da confirmação de senha ou confirmação está vazia
        var verif_emailFunc = emailVar.indexOf('@') == -1 || emailVar == ""; //Email não tem @ ou email vazio
        var verif_senha = senhaVar.length <= 6 || senhaVar == ""; //Senha fraca ou vazia
        var verif_cpf = cpfVar.length < 11 || cpfVar.length > 11 || isNaN(cpfVar);//CPF com menos ou mais de 11 digitos


        if (valida_vazio){//Nenhum campo preenchido
            alert("Todos os campos estão vazios, preencha-os corretamente!");
            return false;
        }
        else {//Alguns campos preenchidos
            if (nome_vazio) {
                alert("Nome deve ser informado corretamente!");
                return false;
            }

            if (verif_emailFunc) {
                alert("E-mail deve ser informado corretamente!");
                return false;
            }

            if (verif_cpf) {
                alert("CPF deve ser informado corretamente! (11 Dígitos)");
                return false;
            }

            if (verif_senha) {
                alert("Senha inválida! Sua senha deve ser maior que 6 dígitos!");
                return false;
            }

            if (verif_chkSenha){
                alert("Confirmação da senha incompatível!");
                return false;
            }
        }

        // Enviando o valor da nova input
        fetch("/usuarios/cadastrarAdm", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeServer: nomeVar,
                senhaServer: senhaVar,
                emailServer: emailVar,
                cpfServer: cpfVar
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                alert("Cadastro realizado com sucesso! Redirecionando para o cadastro de empresa");
                document.getElementById("tela1").style.display = "none";
                document.getElementById("tela2").style.display = "block";
                

                // limparFormulario();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            //finalizarAguardar();
        });

        return false;

    }

    function cadastraEmpresa() {
        //================Informações da empresa=============//
        var nomeVar = ipt_nomeEmpresa.value;//Obrigatório
        var descVar = ipt_descricaoEmpresa.value;//Obrigatório
        var cnpjVar = ipt_cnpj.value;//Obrigatório

        //=====================Contato=================//
        var telVar = ipt_telefone.value;//Obrigatório
        var emailVar = ipt_email.value;//Obrigatório
        var confirmarEmail = ipt_emailConfirm.value;//Pensando em retirar

        //===================Endereço================//
        var ruaVar = ipt_rua.value;//Obrigatório
        var bairroVar = ipt_bairro.value;//Obrigatório
        var cidadeVar = ipt_cidade.value;//Obrigatório
        var estadoVar = ipt_estado.value;//Obrigatório (UF????)
        var cepVar = ipt_cep.value;//Obrigatório
        var numeroVar= ipt_numero.value;//Obrigatório
        // var compVar = ipt_complemento.value;

        //Verificação de campos vazios
        //Todos os campos estão vazios
        var valida_vazio = nomeVar == "" && descVar == "" && cnpjVar == "" && telVar == "" && emailVar == "" && confirmarEmail == ""
        && ruaVar == "" && bairroVar == "" && cidadeVar == "" && estadoVar == "" && cepVar == "" && numeroVar == ""; //Todos os campos estão vazios
        
        //Validações (Se verdadeiro, campo incorreto)
        var nome_vazio = nomeVar == "";//Nome está vazio
        var desc_vazio = descVar == "";//Descrição está vazia

        //verifica se e o tamanho do digitado é diferente do padrão(14 dígitos) e elimina os valores falsos mais comuns
        var verif_cnpj = cnpjVar.length != 14 || cnpjVar == '00000000000000' || cnpjVar == '11111111111111' || cnpjVar == '22222222222222' || 
        cnpjVar == '33333333333333' || cnpjVar == '44444444444444' || cnpjVar == '55555555555555' || cnpjVar == '66666666666666' || 
        cnpjVar == '77777777777777' || cnpjVar == '88888888888888' || cnpjVar == '99999999999999' || isNaN(cnpjVar);

        var valida_telefone = telVar.length <= 8 || telVar.length >= 12 || isNaN(telVar); //Telefone com menos de 9 ou maior que 11 dígitos
        var verif_emailFunc = emailVar.indexOf('@') == -1 || emailVar == ""; //Email não tem @ ou email vazio
        var valida_chkEmail = emailVar != confirmarEmail; //Confirmação é diferente do email
        var rua_vazio = ruaVar == "";//Rua está vazio
        var bairro_vazio = bairroVar == "";//Bairro está vazio
        var cidade_vazio = cidadeVar == "";//Cidade está vazio
        var verif_estado = estadoVar.length != 2 || estadoVar == "";//Estado não é UF ou está vazio
        var verif_cep = cepVar.length != 8 || isNaN(cepVar); //CEP menor que 8 dígitos
        var numero_vazio = numeroVar == "";//Número está vazio

        if (valida_vazio) {
            alert("Todos os campos estão vazios, preencha-os corretamente!");
            return false;

        } else {
            if (nome_vazio) {
                alert("Nome deve ser informado corretamente!");
                return false;
            }

            if (desc_vazio) {
                alert("Descrição deve ser informada corretamente!");
                return false;
            }

            if (verif_cnpj) {
                alert("CNPJ deve ser informado corretamente! (Deve conter 14 dígitos)");
                return false;
            }

            if (valida_telefone) {
                alert("Telefone deve ser informado corretamente! (Deve conter entre 9 a 11 dígitos)");
                return false;
            }

            if (verif_emailFunc) {
                alert("E-mail deve ser informado corretamente!");
                return false;
            }

            if (valida_chkEmail) {
                alert("Confirmação de e-mail é incompatível!");
                return false;
            }

            if (rua_vazio) {
                alert("Rua deve ser informada corretamente!");
                return false;
            }

            if (bairro_vazio) {
                alert("Bairro deve ser informado corretamente!");
                return false;
            }

            if (cidade_vazio) {
                alert("Cidade deve ser informada corretamente!");
                return false;
            }

            if (verif_estado) {
                alert("Estado deve ser informado corretamente! (Formato UF)");
                return false;
            }

            if (verif_cep) {
                alert("CEP deve ser informado corretamente! (Deve conter 8 dígitos)");
                return false;
            }

            if (numero_vazio) {
                alert("Numero de endereço deve ser informado corretamente!");
                return false;
            }
        }

        // Enviando o valor da nova input
        fetch("/usuarios/cadastrarEmpresa", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                cnpjServer: cnpjVar,
                descServer: descVar,
                nomeServer: nomeVar,
                telServer: telVar,
                emailServer: emailVar,
                //whatsServer: whatsVar,
                ruaServer: ruaVar,
                cidadeServer: cidadeVar,
                estadoServer: estadoVar,
                bairroServer: bairroVar,
                cepServer: cepVar,
                numServer: numeroVar
                //compServer: compVar
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                //cardErro.style.display = "block";
                
                alert("Cadastro realizado com sucesso! Redirecionando para o cadastro de fábrica");
                document.getElementById("tela3").style.display = "block";
                document.getElementById("tela2").style.display = "none";
                

                cadFkAdmEmpresa();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });

        return false;

    }

    function cadFkAdmEmpresa(){
        var cnpjVar = ipt_cnpj.value;//Obrigatório
        var nomeVar = ipt_nomeAdm.value;//Obrigatório
        var emailVar = ipt_emailAdm.value;//Obrigatório

        // Enviando o valor da nova input
        fetch("/usuarios/cadFkEmpAdm", {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeServer: nomeVar,
                emailServer: emailVar,
                cnpjServer:cnpjVar
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {

            } else {
                throw ("Houve um erro ao tentar realizar a atualização de adm com o id da empresa!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
    
        });

        return false;
        
    }
    
    var numSetorVar = ipt_numSetores.value;
    function cadastraFabrica() {

        //=======Informações da fábrica=======//
        var nomeVar = ipt_nomefabrica.value;
        var telVar = ipt_telefoneFabrica.value;
        numSetorVar = ipt_numSetores.value;
        var empresaVar = ipt_nomeEmpresa.value;
        var cnpjVar = ipt_cnpj.value;//Obrigatório

        //=======Endereço da fábrica=========//
        var ruaVar = ipt_ruaFabrica.value;
        var compVar = ipt_complementoFabrica.value;
        var cepVar = ipt_cepFabrica.value;
        var bairroVar = ipt_bairroFabrica.value;
        var cidadeVar = ipt_cidadeFabrica.value;
        var numVar = ipt_numeroFabrica.value;
        var estadoVar = ipt_EstadoFabrica.value;
        
        //Verificação de campos vazios
        var valida_vazio = nomeVar == "" && telVar == "" && numSetorVar == "" && numVar == "" && ruaVar == "" && compVar == "" && cepVar == "" && 
        bairroVar == "" && cidadeVar == ""; //Todos os campos estão vazios

        //Validações (Se verdadeiro, campo incorreto)
        var nome_vazio = nomeVar == '';//Nome está vazio
        var valida_telefone = telVar.length <= 8 || telVar.length >= 12 || isNaN(telVar); //Telefone com menos de 9 ou maior que 11 dígitos
        var valida_setor = numSetorVar == "" || isNaN(numSetorVar);//Número de setores está vazio ou não é um número
        var rua_vazio = ruaVar == "";//Rua está vazio
        var verif_cep = cepVar.length != 8 || isNaN(cepVar); //CEP menor que 8 dígitos
        var verif_estado = estadoVar.length < 2 || estadoVar.length > 2;
        var bairro_vazio = bairroVar == "";//Bairro está vazio
        var cidade_vazio = cidadeVar == "";//Cidade está vazio
        var numero_vazio = numVar == "";//Número está vazio
        var estado_vazio = estadoVar == "";//Estado está vazio


        
        if (valida_vazio) {
            alert("Todos os campos estão vazios, preencha-os corretamente!");
            return false;
        } else {
            if (nome_vazio) {
                alert("Nome deve ser informado corretamente!");
                return false;
            }

            if (estado_vazio) {
                alert("O estado deve ser informado corretamente!");
                return false;
            }

            if (valida_telefone) {
                alert("Telefone deve ser informado corretamente! (Deve conter entre 9 a 11 dígitos)");
                return false;
            }

            if (valida_setor) {
                alert("Quantifique a quantidade de setores da fábrica!");
                return false;
            }

            if (rua_vazio) {
                alert("Rua deve ser informada corretamente!");
                return false;
            }

            if (verif_cep) {
                alert("CEP deve ser informado corretamente! (Deve conter 8 dígitos)");
                return false;
            }

            if (verif_estado) {
                alert("Estado inválido, siga o modelo: UF)");
                return false;
            }

            if (bairro_vazio) {
                alert("Bairro deve ser informado corretamente!");
                return false;
            }

            if (cidade_vazio) {
                alert("Cidade deve ser informada corretamente!");
                return false;
            }

            if (numero_vazio) {
                alert("Numero de endereço deve ser informado corretamente!");
                return false;
            }
        }

        // Enviando o valor da nova input
        fetch("/usuarios/cadastrarFabrica", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeServer: nomeVar,
                telServer: telVar,
                numServer: numVar,
                ruaServer: ruaVar,
                bairroServer: bairroVar,
                estadoServer: estadoVar,
                cidadeServer: cidadeVar,
                compServer: compVar,
                cepServer: cepVar,
                empresaServer: empresaVar,
                cnpjServer: cnpjVar
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                //cardErro.style.display = "block";

                alert("Cadastro realizado com sucesso! Redirecionando para tela de Login...");
                window.location = "../login/login.html";
                setTimeout(() => {
                  window.location = "login.html";
                }, "2000")

                //limparFormulario();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            //finalizarAguardar();
        });

        return false;

    }
</script>