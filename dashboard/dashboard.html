<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Visão Geral</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script>
    <title>Dashboard Visão Geral</title>
    <link rel="stylesheet" href="../css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="divGrande">

        <div class="parteVerde">
            <img class="logo" src="../img/Logo.png" alt="Logo da parte verde" width="200" height="50">
            <div class="setores">
                <div class="geral"><b>Visão Geral</b></div>
                <br>
                <div class="setor1">
                    <h1>1° Setor</a></h1>
                    <p><a href="dashboard_1setor.html" class="linkSetor">Banheiros</a></p>
                    <p>Área de produção</p>
                    <p>Refeitório</p>
                    <p>Corredor</p>
                </div>

                <div class="setor2">
                    <h1>2° Setor</h1>
                    <p>Banheiros</p>
                    <p>Área de produção</p>
                    <p>Refeitório</p>
                    <p>Corredor</p>
                </div>
            </div>


        </div>

        <div class="conteudo">
            <div class="header">
                <img class="imagem-perfil" src="../img/login.png" alt="Foto-usuario" width="40px" height="40px">
                <h1>Emily</h1>
            </div>
            <div>
                <h1 class="titulo">Visão Geral</h1>
            </div>
            <div class="quadrados">
                <div class="organizar-quadrados">
                    <div class="linha">
                        <div class="quadrado">
                            <p><b>Horário de maior pico</b></p>
                            <br>
                            <h4>18:30h</h4>
                        </div>

                        <div class="quadrado">
                            <p><b>Lugar menos movimentado</b></p>
                            <h4 style="margin-left: 4px; text-align: center; margin-top: 15px;">Área de produção (3º
                                andar)</h4>
                        </div>

                        <div class="quadrado">
                            <p><b>Lugar mais movimentado</b></p>
                            <br>
                            <h4>2° Refeitório</h4>
                        </div>
                    </div>

<!-- quadrado do setor funcional inicio -->

                    <div class="quadrado-maior">
                        <div style="display: flex; margin-left: 20px;">
                            <div style="width: 95%;">
                                <canvas id="myChart2"></canvas>
                            </div>
                        </div>
                    </div>

<!-- quadrado do setor funcional fim -->

                </div>
                <div class="organizar-quadrados">

                    <div class="alerta">
                        <p><b>Alertas ❗</b></p>
                        <div class="caixa-alerta">
                            <p>Máquina 2 parada por 20 minutos</p>

                        </div>
                        <div class="caixa-alerta">
                            <p>Super lotação no refeitório 2</p>

                        </div>
                        <div class="caixa-alerta">
                            <p>Máquina 3 parada por 50 min</p>

                        </div>
                        <div class="caixa-alerta">
                            <p>Pouco fluxo na área de produção</p>
                        </div>
                    </div>
                    <div class="quadrado2">
                        <div style="display: flex;">
                            <div style="width: 100%;">
                                <canvas id="myChart3"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <h1 class="titulo2">Fluxo de pessoas nos setores</h1>
            </div>
            <div class="linha2">
                <div>
                    <h2>1° Setor</h2>
                    <div class="quadrado3">
                        <div style="display: flex;">
                            <div class="chart1" style="width: 100%;">
                                <canvas id="myChart" width="580px" height="350px"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <h2>2° Setor</h2>
                    <div class="quadrado3">
                        <div style="display: flex;">
                            <div class="chart1" style="width: 100%;">
                                <canvas id="myChart4" width="580px" height="350px"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                </div>
            </div>

            <div>
                <h1 class="titulo2">Fluxo de pessoas nos refeitorios</h1>
            </div>
            <div>
                <h1 class="grafico-refeitorio">
                    <div style="display: flex;">
                        <div class="chart1" style="width: 350px">
                            <canvas id="myChart5"></canvas>
                        </div>
                    </div>
                </h1>
            </div>

        </div>  
</body>

<script>
    const ctx2 = document.getElementById('myChart2');
    var chave = new Chart(
            ctx2,
            {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Chave',
                        type: 'line',
                        borderColor: ['rgba(2, 160, 8, 0.8)'],
                    }]
                },
                options: {
                    scales: {
                        xAxes: [{
                            distribution: 'series',
                            ticks: {
                                beginAtZero: true
                            }
                        }],
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'Chave'
                            },
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    },
                    animation: {
                        duration: 0
                    }
                }
            }
        );

        var paginacao = {};
        var tempo = {};
        function obterDados(grafico, endpoint) {
            var http = new XMLHttpRequest();
            http.open('GET', 'http://localhost:3000/sensores/' + endpoint, false);
            http.send(null);
            var valores = JSON.parse(http.responseText);
            if (paginacao[endpoint] == null) {
                paginacao[endpoint] = 0;
            }
            if (tempo[endpoint] == null) {
                tempo[endpoint] = 0;
            }
            // Exibir à partir do último elemento exibido anteriormente
            var ultimaPaginacao = paginacao[endpoint];
            paginacao[endpoint] = valores.length;
            var valores = valores.slice(ultimaPaginacao);
            valores.forEach((valor) => {
                //Máximo de 60 itens exibidos no gráfico
                if (grafico.data.labels.length == 10 && grafico.data.datasets[0].data.length == 10) {
                    grafico.data.labels.shift();
                    grafico.data.datasets[0].data.shift();
                }

                grafico.data.labels.push(tempo[endpoint]++);
                grafico.data.datasets[0].data.push(parseFloat(valor));
                grafico.update();
            })
        }

        setInterval(() => {
           // obterDados(dht11Umidade, 'dht11/umidade');
            //obterDados(dht11Temperatura, 'dht11/temperatura');
            //obterDados(luminosidade, 'luminosidade');
            //obterDados(lm35Temperatura, 'lm35/temperatura');
            obterDados(chave, 'chave');
        }, 1000);

</script>

</script>

<!-- script dp quadrado do setor funcional fim -->
<script>

    const ctx3 = document.getElementById('myChart3');

    new Chart(ctx3, {
        type: 'doughnut',
        data: {
            labels: [
                'Red',
                'Blue',
            ], datasets: [{
                label: 'Fluxo atual',
                data: [300, 50],
                backgroundColor: [
                    'rgb(255, 99, 132)',
                    'rgba(0, 160, 8, 0.8)',
                    'rgba(0, 160, 8, 0.8)',
                    '#B4FF5C',
                ],
                hoverOffset: 4
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

</script>

<script>

    const ctx4 = document.getElementById('myChart4');

    new Chart (ctx4 = {
        type: 'line',
        data: data,
    });

    const labels = Utils.months({ count: 7 });
    const data = {
        labels: labels,
        datasets: [{
            label: 'My First Dataset',
            data: [65, 59, 80, 81, 56, 55, 40],
            fill: false,
            borderColor: 'rgb(75, 192, 192)',
            tension: 0.1
        }]
    };

</script>
<script>
    const setor2 = document.getElementById('myChart5');
    
</script>


</script>


<script>
    const ctx = document.getElementById('myChart');

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['5:00', '6:00', '7:00', '8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00'],
            datasets: [{
                label: 'Fluxo no setor',
                data: [23, 22, 25, 23, 26, 29, 29, 30, 28, 25, 22, 23, 15, 18, 17, 14, 11, 32],
                borderWidth: 1,
                backgroundColor: [
                    'rgba(2, 160, 8, 0.8)'
                ],
                backgroundColor: [
                    'rgba(2, 160, 8, 0.8)'
                ]
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: false
                }
            }
        }
    });

</script>

<script>
    const ctx6 = document.getElementById('myChart4');

    new Chart(ctx6, {
        type: 'line',
        data: {
            labels: ['5:00', '6:00', '7:00', '8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00'],
            datasets: [{
                label: 'Fluxo no setor',
                data: [23, 22, 25, 23, 26, 29, 29, 30, 28, 25, 22, 23, 15, 18, 17, 14, 11, 32],
                borderWidth: 1,
                backgroundColor: [
                    'rgba(2, 160, 8, 0.8)'
                ],
                backgroundColor: [
                    'rgba(2, 160, 8, 0.8)'
                ]
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: false
                }
            }
        }
    });

</script>

<script>

    const ctx5 = document.getElementById('myChart5');

    new Chart(ctx5, {
        type: 'pie',
        data: {
    datasets: [{
        data: [10, 30],
        backgroundColor: [
                    'rgba(127, 252, 92, 0.8)',
                    'rgba(0, 160, 8, 0.8)',
                ],
    
    }],

    // These labels appear in the legend and in the tooltips when hovering different arcs
    labels: [
        'Refeitorio 1',
        'Refeitorio 2',
    ]
    }
});

</script>
</html>